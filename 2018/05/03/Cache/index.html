<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Session ViewState Cookie Cache -1"><meta name="keywords" content="����"><meta name="author" content="Black_Jack,undefined"><meta name="copyright" content="Black_Jack"><title>Session ViewState Cookie Cache -1 | 穷不忘道,老而能学</title><link rel="shortcut icon" href="/blog/favicon.ico"><link rel="stylesheet" href="/blog/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.3"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/blog/',
  algolia: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  localSearch: undefined
} </script></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Session"><span class="toc-number">1.</span> <span class="toc-text">Session</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#����"><span class="toc-number">1.0.1.</span> <span class="toc-text">����</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#�������"><span class="toc-number">1.0.2.</span> <span class="toc-text">�������</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Code"><span class="toc-number">1.0.3.</span> <span class="toc-text">Code</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Session-Identifiers"><span class="toc-number">1.0.4.</span> <span class="toc-text">Session Identifiers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CookieLess-SessionIDs"><span class="toc-number">1.0.5.</span> <span class="toc-text">CookieLess SessionIDs</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Regenerating-Expired-Session-Identifiers"><span class="toc-number">1.0.6.</span> <span class="toc-text">Regenerating Expired Session Identifiers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#��Session-Identifiers�����Զ���"><span class="toc-number">1.0.7.</span> <span class="toc-text">��Session Identifiers�����Զ���</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Session��gʽ"><span class="toc-number">1.0.8.</span> <span class="toc-text">Session��ģʽ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Session�е��¼�"><span class="toc-number">1.0.9.</span> <span class="toc-text">Session�е��¼�</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Session-State����"><span class="toc-number">1.0.10.</span> <span class="toc-text">Session State����</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#���������Session-State"><span class="toc-number">1.0.11.</span> <span class="toc-text">���������Session State</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ViewState"><span class="toc-number">2.</span> <span class="toc-text">ViewState</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#����-1"><span class="toc-number">2.0.1.</span> <span class="toc-text">����</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ӧ�o���"><span class="toc-number">2.0.2.</span> <span class="toc-text">Ӧ�ó���</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ʲoʱ����ViewState���д洢"><span class="toc-number">2.0.3.</span> <span class="toc-text">ʲôʱ����ViewState���д洢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Control-State"><span class="toc-number">2.0.4.</span> <span class="toc-text">Control State</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Saving-Vlues-in-View-State"><span class="toc-number">2.0.5.</span> <span class="toc-text">Saving Vlues in View State</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ViewState��֧�ֵ���������"><span class="toc-number">2.0.6.</span> <span class="toc-text">ViewState��֧�ֵ���������</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Reading-values-from-ViewState"><span class="toc-number">2.0.7.</span> <span class="toc-text">Reading values from ViewState</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Securing-ViewState"><span class="toc-number">2.0.8.</span> <span class="toc-text">Securing ViewState</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/blog/img/avatar.png"></div><div class="author-info__name text-center">Black_Jack</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/blog/archives"><span class="pull-left">Articles</span><span class="pull-right">7</span></a><a class="author-info-articles__tags article-meta" href="/blog/tags"><span class="pull-left">Tags</span><span class="pull-right">5</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container" style="background-image: url(true)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/blog/">穷不忘道,老而能学</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">Session ViewState Cookie Cache -1</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-05-03</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div id="post-content"><h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><h4 id="����"><a href="#����" class="headerlink" title="����"></a>����</h4><p>����HTTPЭ������״̬��(stateless),���������ÿһ�ε�HTTP������һ�ε�����������˷���Ҳ��֪��֮ǰ�������е�һЩ���������������û���Ϣ��Ӧ���еĳ��������ȡ�����WebӦ���У�����ͨ����Ҫ֪�����ʵ��û���һЩ�û���Ϣ�����������ĳ�����Session State identifiers �ͳ����ˣ������Ա��ͬһ����������������,����һ��ʱ������Ϊsession���棬��session�����ǾͿ���ʵ��һЩ�����������ʱ����ĳ־û��ˡ�������Ϊ��ǵ�������������������ڷ������˽��в�����ʱ�򣬷��ʵ�session���������Ӧ������ģ�����֮����������û��ġ�</p>
<h4 id="�������"><a href="#�������" class="headerlink" title="�������"></a>�������</h4><p>��Ȼ����session����������������һЩ���汣����ʱ������</p>
<ul>
<li>Application State,���Դ洢��ͬһ��Ӧ���������û������Է��ʵı���</li>
<li>Profile Properties,�����ڱ���һЩ�û����ݣ�����ʱ������</li>
<li>ASP.NET Cache�����Խ����ݱ������ڴ��У���ͬһ���������µ�����Ӧ�þ����Է��ʡ��Ӷ�����IO�ķ���������߷����ٶ�</li>
<li>ViewState ���Խ����ݱ����ڵ�ǰҳ���У����ܿ�ҳ�����</li>
<li>Cookies ���Խ����ݱ�����������У�ͨ�����ڱ���һЩ�����¼</li>
<li>Http Request URL��HTML Form Ҳ���Ա���һЩ����������У�����ҳ�����</li>
</ul>
<h4 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h4><p>��Session���и�ֵ<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Session[<span class="string">"FirstName"</span>] = userInfo.Account</span><br><span class="line">Session[<span class="string">"LastName"</span>] = userInfo.UserName</span><br></pre></td></tr></table></figure></p>
<p>Session �еı�������ʵ������.net �е��κ����͡���������Ҫ����ʵ������ʱ������ȷ�������Ƿ����<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">UserInfo userInfo = (ArrayList)Session[<span class="string">"UserInfo"</span>];</span><br><span class="line">Session[<span class="string">"UserInfo"</span>] = userInfo;</span><br></pre></td></tr></table></figure></p>
<h4 id="Session-Identifiers"><a href="#Session-Identifiers" class="headerlink" title="Session Identifiers"></a>Session Identifiers</h4><p>�ڱ����У�������Session����Ψһ��SessionID���б�ǵģ�ͬʱ������Ҳ����SessionID��ȡ��Ӧ��Session���ݡ�����ڷ������˵�Ӧ����������Session����ôÿһ�ε�ҳ���������������У����������е�SessionID,������������û��SessionID,��ASP.NET�л����һ���µ�Session��ͬʱ����Ӧ��SessionID���ظ��������ͨ�������SessionID�ᱻ���浽Cookie�С������Configure��������CookieLess,���SessionID���������url�С�</p>
<p>��֮��������У�SessionIDû�г�ʱ�ͻ��϶�Ϊ���ǻ(Active)״̬�������ʱ�ˣ��ͻ��ٴ��½�һ��Session��</p>
<blockquote>
<p>������Cache������URL�����У�Session�������ı���ģ������û�һ����ȡ������ͬʱsession������һЩ��������Ϣ��Ȼ��������ˡ���ʱ�������Browser��Server֮����SSL���м��ܡ�</p>
</blockquote>
<h4 id="CookieLess-SessionIDs"><a href="#CookieLess-SessionIDs" class="headerlink" title="CookieLess SessionIDs"></a>CookieLess SessionIDs</h4><p>ͨ��SessionID������Cookie�У�����Ҳ����ͨ����Web.Config�ļ��ж�<strong>CookieLess</strong>���Խ������ã����ý���Ϣ����<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;system.web&gt;</span><br><span class="line">    &lt;sessionState cookieless=&quot;true&quot;</span><br><span class="line">      regenerateExpiredSessionId=&quot;true&quot; /&gt;</span><br><span class="line">  &lt;/system.web&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></p>
<p>����Cookieless���Խ�������֮��ASP.NET���Զ���SessionID���뵽ҳ���URL��<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.example.com/(S(lit3py55t21z5v55vlm25s55))/orderform.aspx</span><br></pre></td></tr></table></figure></p>
<p>���Ǳ��浽URL�к�����û��ֶ�����URL�����������޷����������SessionID,��ˣ�һ���µ�Session�ֻ���Ϊ������󴴽���</p>
<h4 id="Regenerating-Expired-Session-Identifiers"><a href="#Regenerating-Expired-Session-Identifiers" class="headerlink" title="Regenerating Expired Session Identifiers"></a>Regenerating Expired Session Identifiers</h4><p>SessionID ��Cookieless Sessions �����������л��ջ��Ƶģ�SessionID������������¿��ܻᱻ��������ʹ�ã���ΪURL���ܻᱻ����;�����ݡ���ȻҲ��������SessionID�����գ������������Ҫ����<strong>regenerateExpiredSessionId</strong>������ֵΪ<strong>true</strong>���������SessionID�����ˣ��ͻ���������һ���µ�SessionID</p>
<blockquote>
<p>���һ��������һ�����ڵ�SessionID����HTTP POST�������е�POST �����е����ݶ��ᶪʧ����Ϊ���ڵ�Ե�ʣ�ASP.NET��������������ض���</p>
</blockquote>
<h4 id="��Session-Identifiers�����Զ���"><a href="#��Session-Identifiers�����Զ���" class="headerlink" title="��Session Identifiers�����Զ���"></a>��Session Identifiers�����Զ���</h4><p>ͨ������һ���̳���SessionIDManager class��ͬʱ��дCreateSessionID��Validate�������Զ������sessionId������֤��<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Configuration;</span><br><span class="line"><span class="keyword">using</span> System.Web.Configuration;</span><br><span class="line"><span class="keyword">using</span> System.Web;</span><br><span class="line"><span class="keyword">using</span> System.Web.SessionState;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Samples.AspNet.Session</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GuidSessionIDManager</span> : <span class="title">SessionIDManager</span></span><br><span class="line">  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">string</span> <span class="title">CreateSessionID</span>(<span class="params">HttpContext context</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> Guid.NewGuid().ToString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">bool</span> <span class="title">Validate</span>(<span class="params"><span class="keyword">string</span> id</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        Guid testGuid = <span class="keyword">new</span> Guid(id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (id == testGuid.ToString())</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span></span><br><span class="line">      &#123;</span><br><span class="line">         WriteLog(Some Information);</span><br><span class="line">         DoSomeActions();</span><br><span class="line">         <span class="keyword">throw</span>  CustomException();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Ҳ����ͨ��ISessionIDManager���SessionIDManager�������ڷ�ASP.NETҳ����ͨ��ʹ��ISAPI filter�������������Cookieless�ģ���ʱ�����Ҫ���������ķ���������URL�ˡ�</p>
<h4 id="Session��gʽ"><a href="#Session��gʽ" class="headerlink" title="Session��ģʽ"></a>Session��ģʽ</h4><p>ASP.NET session state��֧�ֶ�session�еı����м��ֲ�ͬ�Ĵ洢ģʽ��ͨ���ᱣ���ڶ�Ӧ�Ľ����У�Ҳ���Ա�����һ�������Ľ����У� ����SQLSERVER���ݿ⣬�������Զ��������Դ�С���Ȼ�����Ӧ���У�������Session,Ҳ����������Session Mode��״̬Ϊ<strong>off</strong></p>
<h4 id="Session�е��¼�"><a href="#Session�е��¼�" class="headerlink" title="Session�е��¼�"></a>Session�е��¼�</h4><p><strong>Session_OnStart</strong> һ��session����ʱ����<br><strong>Session_OnEnd</strong> һ��session�����ٻ��߹���ʱ������Ȼ��������inProc�����£�����¼��ǲ�֧�ֵġ�</p>
<p>�����Ҫ����Session�¼�����Ҫ��Global.asax�����Ӷ�Ӧ�Ĵ��롣</p>
<blockquote>
<p>����Session State��״̬��Global.asax�ļ���WebConfig�ļ�������أ������޸ģ����ܻᵼ��Session State�Ķ�ʧ����Ҫ�Ϸ����ಡ�����������ļ����ݵ��޸ġ�</p>
</blockquote>
<h4 id="Session-State����"><a href="#Session-State����" class="headerlink" title="Session State����"></a>Session State����</h4><p>Session state��Web.Config�ļ���������System.web���ý��¡�<br>��sessionStateԪ���������²�����Ҫ����</p>
<ul>
<li>�洢Session�ķ�ʽ</li>
<li>sessionId��browser��server֮��Ĵ��ݷ�ʽ</li>
<li>����ʱ��</li>
<li>����Mode״̬��ѡ�����ò���<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;sessionState mode=&quot;SQLServer&quot;</span><br><span class="line">  cookieless=&quot;true &quot;</span><br><span class="line">  regenerateExpiredSessionId=&quot;true &quot;</span><br><span class="line">  timeout=&quot;30&quot;</span><br><span class="line">  sqlConnectionString=&quot;Data Source=MySqlServer;Integrated Security=SSPI;&quot;</span><br><span class="line">  stateNetworkTimeout=&quot;30&quot;/&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="���������Session-State"><a href="#���������Session-State" class="headerlink" title="���������Session State"></a>���������Session State</h4><p>ASP.NET Session��ÿһ��Session���Ƕ����ģ������ζ��������ͬ���û����в��������ʱ��Session�����ǲ����ġ������������������������ͬһ��SessionID����һ������͵õ���ȡSession�����ݵ�ΨһȨ�ޡ��ڶ�������ִ��ֻ�ܵȵ���һ���������֮�󣬼���һ��������Ϊ˵ʱ�䳬ʱ�ͷ�Ψһ�������EnableSessionState ��ֵ��page������ΪReadOnly��ֻ�������ȴ���д������֮��</p>
<h2 id="ViewState"><a href="#ViewState" class="headerlink" title="ViewState"></a>ViewState</h2><h4 id="����-1"><a href="#����-1" class="headerlink" title="����"></a>����</h4><p>��Session��Ƶ�ԭ����Щ���ƣ�ViewStateҲ������WebApplication ��stateless�Ĳ���Ƴ����ġ���ͬ���ǣ�Session�Ƕ�������Browser��Server֮��Ľ�����������һЩ���õ����ݡ�������ViewState��������Ϊ��Ҫ����ҳ��Ϳؼ���һЩ��Ϣ��ҳ��Ϳؼ�����Ϣ����ÿһ�ν�������֮�󣬶��ᶪʧ������΢��Ϊ�˿˷�������ƣ�����ASP.NET��ܼ�����ViewState����ơ���HTMLҳ����Ⱦ��֮��ҳ���state��Ϣ�����base64�ı�����뵽�����ֶλ��ֶ��У��Ӷ�����ͨ��ViewState������Խ��л�ȡ��</p>
<h4 id="Ӧ�o���"><a href="#Ӧ�o���" class="headerlink" title="Ӧ�ó���"></a>Ӧ�ó���</h4><p>ViewState �Ƕ��ڵ�ҳ��Ϣ�Ĵ洢,ViewState�����־û�ҳ����н�����ʱ��ĸ������ݡ����������ؼ�������Ч����</p>
<ul>
<li>��Ϊsession��user profile���������</li>
<li>���Դ���View State Provider�Ӷ���SQL SERVER���������洢��ΪViewState�洢</li>
</ul>
<h4 id="ʲoʱ����ViewState���д洢"><a href="#ʲoʱ����ViewState���д洢" class="headerlink" title="ʲôʱ����ViewState���д洢"></a>ʲôʱ����ViewState���д洢</h4><ul>
<li>ViewState�ǲ��ܿ�ҳ����ʵģ������Ҫ��ҳ����ʴ���־û������ݣ����ʱ�����ʹ�� ApplicationState,Session��Profile Properties �����Ĵ洢���</li>
<li>ViewState����ô洢��������ݣ����򽫻�Ӱ�쵽ҳ�������</li>
<li>����������ֶ��е�����������һЩ���غͷ���ǽҲ��ܾ���Ȩ���ʡ�������ǽ�����ض��������ֶε�����������������Ǹ��ݲ�ͬ������������״�����м��ɵġ�ͨ��״���У�������Ҫ��MaxPageStateFieldLength���Խ��и�ֵ��ҳ�������͵���������ʱ�򣬱�����������е������ֶν��з�������֤�����ֶεĴ�С�ڷ��������ƵĴ�С֮�¡�</li>
<li>ViewState��Ĭ��ʹ�õģ�����еĿؼ�ÿ��������Ҫˢ�£���ʱ����Խ�ViewState��״̬��Ϊoff���Ӷ�����ViewState�Ĵ�С</li>
<li>ĳЩ�ƶ����豸��֧�������ֶΣ�ViewState����Щ�豸��Ҳ���޷�ʹ��</li>
</ul>
<h4 id="Control-State"><a href="#Control-State" class="headerlink" title="Control State"></a>Control State</h4><p>������ViewState,ASP.NETҲ֧��Control State����ViewState����</p>
<h4 id="Saving-Vlues-in-View-State"><a href="#Saving-Vlues-in-View-State" class="headerlink" title="Saving Vlues in View State"></a>Saving Vlues in View State</h4><blockquote>
<p>���Ҫ��ViewState������ԣ�ASP.NET page����Ҫ�и�form Ԫ��ͬʱ�������� runat=”server”</p>
</blockquote>
<p>ʹ�÷���������ʾ<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Page Language=<span class="string">"C#"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC <span class="string">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span> <span class="string">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span>&gt;</span><br><span class="line">&lt;script runat=<span class="string">"server"</span>&gt;</span><br><span class="line">  <span class="comment">// Sample ArrayList for the page.</span></span><br><span class="line">  ArrayList PageArrayList;</span><br><span class="line"></span><br><span class="line">  <span class="function">ArrayList <span class="title">CreateArray</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="comment">// Create a sample ArrayList.</span></span><br><span class="line">    ArrayList result = <span class="keyword">new</span> ArrayList(<span class="number">4</span>);</span><br><span class="line">    result.Add(<span class="string">"item 1"</span>);</span><br><span class="line">    result.Add(<span class="string">"item 2"</span>);</span><br><span class="line">    result.Add(<span class="string">"item 3"</span>);</span><br><span class="line">    result.Add(<span class="string">"item 4"</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Page_Load</span>(<span class="params"><span class="keyword">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ViewState[<span class="string">"arrayListInViewState"</span>] != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      PageArrayList = (ArrayList)ViewState[<span class="string">"arrayListInViewState"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// ArrayList isn't in view state, so it must be created and populated.</span></span><br><span class="line">      PageArrayList = CreateArray();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Code that uses PageArrayList.</span></span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Page_PreRender</span>(<span class="params"><span class="keyword">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="comment">// Save PageArrayList before the page is rendered.</span></span><br><span class="line">    ViewState.Add(<span class="string">"arrayListInViewState"</span>, PageArrayList);</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;html xmlns=<span class="string">"http://www.w3.org/1999/xhtml"</span> &gt;</span><br><span class="line">&lt;head runat=<span class="string">"server"</span>&gt;</span><br><span class="line">    &lt;title&gt;View state sample&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;form id=<span class="string">"form1"</span> runat=<span class="string">"server"</span>&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="ViewState��֧�ֵ���������"><a href="#ViewState��֧�ֵ���������" class="headerlink" title="ViewState��֧�ֵ���������"></a>ViewState��֧�ֵ���������</h4><ul>
<li>Strings </li>
<li>Integers</li>
<li>Boolean</li>
<li>Array </li>
<li>ArrayList</li>
<li>HashTable</li>
<li>Custom Type converters </li>
</ul>
<h4 id="Reading-values-from-ViewState"><a href="#Reading-values-from-ViewState" class="headerlink" title="Reading values from ViewState"></a>Reading values from ViewState</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arrayList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">arrayList = (ArrayList)ViewState[<span class="string">"arrayListInViewState"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.GridView1.DataSource = arrayList;</span><br><span class="line"><span class="keyword">this</span>.GridView1.DataBind();</span><br></pre></td></tr></table></figure>
<p>�����޷��ж�ViewState���Ƿ���ڸ�ֵ��������Ҫ�����keyֵ�����Ƿ�Ϊ���ж�<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (ViewState[<span class="string">"color"</span>] == <span class="literal">null</span>)</span><br><span class="line">    <span class="comment">// No such value in view state, take appropriate action.</span></span><br></pre></td></tr></table></figure></p>
<h4 id="Securing-ViewState"><a href="#Securing-ViewState" class="headerlink" title="Securing ViewState"></a>Securing ViewState</h4><p>viewstate�е�����һ������base64����֮�󱣴��������ֶ��С����һ���ʹ��MAC(Machine Authentication code)�����ݽ��б��룬��ϣֵ�ͱ��������ݱ�����page�С���ҳ��ط����󵽷�������ʱ��ASP.NET Framework�����¼���hash-value��ͬʱ��ViewState�еĽ��бȽϣ������ƥ�䣬�ͻ��׳��쳣��ViewState�б�������ݱ�����Ч�ġ�</p>
<p>ͨ��������ϣֵ��ASP.NET ҳ��ܿ��Բ�����ͼ״̬�����Ƿ��ѱ��𻵻�۸ġ����ǣ���ʹ��ͼ״̬����δ���۸ģ���Щ������Ȼ���ܱ������û��ػ�Ͷ�ȡ��</p>
<p><strong>ʹ�� MAC ������ͼ״̬��ϣֵ</strong><br>���ڼ�����ͼ״̬��ϣֵ�� MAC ��Կ�����Զ����ɣ�Ҳ������ Machine.config �ļ���ָ�����������Կ���Զ����ɵģ�����ڼ������ MAC ��ַ�����Ǹü������������������Ψһ GUID ֵ�����д�����</p>
<p>�����û����Ѹ�����ͼ״̬�еĹ�ϣֵ���з��򹤳̴������ƶϳ� MAC ��Կ����ˣ�MAC ������һ������ȷ����ͼ״̬�����Ƿ��Ѹ��ĵ��൱�ɿ��ķ�ʽ��</p>
<p>ͨ�����������ɹ�ϣ�� MAC ��ԿԽ�󣬲�ͬ�ַ����Ĺ�ϣֵ��ͬ�Ŀ����Ծ�ԽС�������Կ���Զ����ɵģ��� ASP.NET ʹ�� SHA-1 ����������һ��������Կ�������������糡�����У����з���������Կ������ͬ�������Կ��ͬ����ô��ҳ�ط���������ҳ�ķ�����֮�������������ʱ��ASP.NET ҳ��ܽ������쳣����ˣ������糡�����У�Ӧ�� Machine.config �ļ���ָ����Կ���������� ASP.NET �Զ�������Կ������������£���ȷ������������Կ�㹻�����Ա�ʹ��ϣֵ���г�ֵİ�ȫ�ԡ����ǣ���ԿԽ����������ϣ����Ҫ��ʱ��Ҳ��Խ�ࡣ��ˣ������ڰ�ȫ��������������֮�����Ȩ�⡣</p>
<p><strong>������ͼ״̬</strong><br>��Ȼ MAC ���������ڷ�ֹ�۸���ͼ״̬���ݣ������ֱ���Ҳ������û��鿴���ݡ�����ͨ���������ַ�ʽ����ֹ���˲鿴�����ݣ�ͨ�� SSL ����ҳ���Լ�������ͼ״̬���ݡ�Ҫ��ͨ�� SSL ����ҳ�����ڷ�ֹ��Щԭ����Ӧ���յ���ҳ����̽�����ݰ���δ����Ȩ�������ݡ�</p>
<p>���ǣ�����ҳ���û���Ȼ�ܹ��鿴��ͼ״̬���ݣ���Ϊ SSL �����ҳ�Ա���������н�����ʾ���������������Ȩ�û����Է�����ͼ״̬���ݣ������ַ����ܺá�����ĳЩ����£��ؼ����ܻ�ʹ����ͼ״̬�洢�κ��û�����Ӧ���ʵ���Ϣ�����磬ҳ���ܰ���һ�����ݰ󶨿ؼ����ÿؼ��洢��ͼ״̬�����ʶ����������Կ���������Щ��ʶ���а����������ݣ���ͻ� ID������Ӧ����ͼ״̬���ݽ��м��������ͨ�� SSL ����ҳ�����ǽ�����Ϊͨ�� SSL ����ҳ�Ĳ��䷽����</p>
<p>��Ҫ�������ݣ��뽫ҳ�� ViewStateEncryptionMode ��������Ϊ true������ͼ״̬�д洢��Ϣʱ������ʹ�ó���Ķ�д������ҳ��Ϊ���������м��ܺͽ��ܹ���������ͼ״̬���ݽ��м��ܿ��ܻ�Ӱ��Ӧ�ó�������ܡ���ˣ��粻��Ҫ���벻Ҫʹ�ü��ܡ�</p>
<p><strong>�ؼ�״̬����</strong><br>ʹ�ÿؼ�״̬�Ŀؼ�����ͨ������ RegisterRequiresViewStateEncryption ������Ҫ�����ͼ״̬���м��ܡ����ҳ�е��κοؼ���Ҫ�����ͼ״̬���м��ܣ����ҳ�е�������ͼ״̬������м��ܡ�</p>
<p><strong>����ÿ���û�����ͼ״̬����</strong><br>�����վ��Ҫ���û�����������֤����������� Page_Init �¼����������е� ViewStateUserKey ���ԣ��Ա㽫ҳ����ͼ״̬���ض��û���������⽫�����ڷ�ֹһ��ʽ (one-click) �����������ַ�ʽ�Ĺ����У������û�����һ����Ч��Ԥ��������ҳ������ҳ����������ǰ��������ҳ����ͼ״̬����������������ܺ��ߵ���һ�����ӣ�������ʹ���ܺ��ߵı�ʶ�����������ҳ��</p>
<p>��������� ViewStateUserKey ���ԣ���ʹ�ù����ߵı�ʶ������ԭʼҳ����ͼ״̬�Ĺ�ϣ���ܺ��߱��������·��ʹ�ҳʱ�������û���Կ��ͬ����˹�ϣֵҲ����ͬ��������ҳ����֤��ʧ�ܣ���������һ���쳣��</p>
<p>���뽫 ViewStateUserKey ������ÿ���û���һ��Ψһֵ�����û������ʶ�����������</p>
<p><strong>�ڹ������������б������õİ�ȫ��</strong><br>�ڹ��������������У������û����ܻ��޸�״̬�������ԣ��Ӷ�����Ӱ�쵽������ϵ�����Ӧ�ó����޸ķ�ʽ������ֱ���޸� Machine.config��ʹ������������޸ģ��Լ�ʹ���������������ù��߽����޸ġ�������ͨ���������ļ��Ľڽ��м�����������ֹ�����޸�����Ӧ�ó������á��йظ�����Ϣ����μ�ʹ���ܱ��������ü���������Ϣ</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Black_Jack</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://foryl.github.io/blog/2018/05/03/Cache/">https://foryl.github.io/blog/2018/05/03/Cache/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/blog/tags/����/">����</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/blog/2018/05/06/C-实现HttpRequest/"><i class="fa fa-chevron-left">  </i><span>C# ʵ��HttpRequest</span></a></div><div class="next-post pull-right"><a href="/blog/2018/05/03/DNS缓存/"><span>���������,ϵͳ����,·��������,isp DNS����</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2019 By Black_Jack</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/blog/js/third-party/anime.min.js"></script><script src="/blog/js/third-party/jquery.min.js"></script><script src="/blog/js/third-party/jquery.fancybox.min.js"></script><script src="/blog/js/third-party/velocity.min.js"></script><script src="/blog/js/third-party/velocity.ui.min.js"></script><script src="/blog/js/utils.js?version=1.5.3"></script><script src="/blog/js/fancybox.js?version=1.5.3"></script><script src="/blog/js/sidebar.js?version=1.5.3"></script><script src="/blog/js/copy.js?version=1.5.3"></script><script src="/blog/js/fireworks.js?version=1.5.3"></script><script src="/blog/js/transition.js?version=1.5.3"></script><script src="/blog/js/scroll.js?version=1.5.3"></script><script src="/blog/js/head.js?version=1.5.3"></script></body></html>